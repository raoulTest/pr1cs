# AI Agent Role Context Enhancement

## Problem
The AI agent doesn't know the user's role or which tools they can successfully call. This causes the agent to suggest tools that will return ACCESS_DENIED errors.

## Solution
Pass user role and available tools as context in the prompt, maintaining type safety by keeping all tools registered.

## Changes Required

### 1. chat.ts - Add Role Context to Prompts
**Location**: `/home/zakaria/projects/perso/microhack/packages/backend/convex/ai/chat.ts`

**Changes**:
- Import `getUserRole` from internalQueries
- Import `getToolNamesForRole` from tools/types
- Create helper function `buildUserContext(role, userId)` that returns a context string
- Modify `initiateStream` and `generateResponse` to:
  1. Fetch user role using `ctx.runQuery(internal.ai.internalQueries.getUserRole, { userId })`
  2. Get available tools using `getToolNamesForRole(role)`
  3. Prepend context to prompt: "You are assisting a {role}. Available tools: {tools}. "

### 2. Context Format
```
USER CONTEXT:
- Role: {role}
- Available Tools: {comma-separated list}
- Guidelines: Only suggest using the available tools listed above. If the user asks for something requiring a tool not in this list, explain that their role doesn't have access to that feature.

USER MESSAGE: {original prompt}
```

## Type Safety Preserved
- All tools remain registered in `ALL_TOOLS`
- Type inference from agent remains intact
- Access control still enforced inside each tool

## Verification
1. Start a chat as different roles (carrier, terminal_operator, port_admin)
2. Verify the AI only suggests appropriate tools for each role
3. Verify tools still work correctly when called
4. Type check passes: `npx convex typecheck`
