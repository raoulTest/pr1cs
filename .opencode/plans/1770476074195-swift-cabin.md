# Plan: Manual Booking Form for Carriers

## Overview
Add a form-based booking interface for carriers as an alternative to the chatbot. The existing backend mutation `bookings/mutations.ts:create` already supports carrier booking - we only need to build the frontend form.

## Current State
- **Backend**: `api.bookings.create` mutation exists and handles all validation (capacity, truck compatibility, container availability, time constraints)
- **Frontend**: Carriers only have a calendar view at `/carrier/bookings` - no form to create bookings
- **Chatbot**: Uses `createBookingViaAI` which internally calls similar logic

## Implementation

### 1. Create Booking Form Component
**File**: `apps/web/src/features/carrier/components/booking-form.tsx`

Form fields:
- Terminal selector (dropdown from `api.terminals.list`)
- Date picker (calendar, respects min/max advance booking)
- Time slot selector (grid from `api.timeSlots.getAvailableSlots`)
- Truck selector (dropdown from `api.trucks.listByCarrier`)
- Container selector (multi-select from `api.containers.listByCarrier`)
- Driver info (optional: name, phone, ID number)

Use TanStack Form + Zod validation (consistent with codebase patterns).

### 2. Add New Booking Page
**File**: `apps/web/src/routes/_app/carrier/bookings.new.tsx`

- New route at `/carrier/bookings/new`
- Contains the booking form
- Redirects to `/carrier/bookings` on success with toast notification

### 3. Update Carrier Bookings Page
**File**: `apps/web/src/routes/_app/carrier/bookings.tsx`

- Add "Nouvelle réservation" button linking to `/carrier/bookings/new`

### 4. Create Supporting Queries (if missing)
Check if these queries exist, create if needed:
- `api.trucks.listByCarrier` - list carrier's active trucks
- `api.containers.listAvailableByCarrier` - list carrier's unbooked containers

## Files to Modify/Create

| Action | File Path |
|--------|-----------|
| Create | `apps/web/src/features/carrier/components/booking-form.tsx` |
| Create | `apps/web/src/routes/_app/carrier/bookings.new.tsx` |
| Modify | `apps/web/src/routes/_app/carrier/bookings.tsx` |
| Check/Create | `packages/backend/convex/trucks/queries.ts` |
| Check/Create | `packages/backend/convex/containers/queries.ts` |

## Form Flow

```
1. Carrier clicks "Nouvelle réservation"
2. Selects terminal → loads available slots
3. Selects date → shows time slot grid
4. Selects time slot
5. Selects truck (filtered by terminal compatibility)
6. Selects containers (filtered by availability)
7. Optionally fills driver info
8. Submits → calls api.bookings.create
9. Success → redirect to calendar with confirmation toast
```

## Validation (handled by backend)
- Slot must be in future with min/max advance rules
- Truck must be active, owned by carrier, compatible with terminal
- Containers must be active, owned by carrier, not already booked
- Capacity must be available in the selected slot

## Verification
1. Navigate to `/carrier/bookings` as a carrier
2. Click "Nouvelle réservation" button
3. Complete the form with valid data
4. Submit and verify booking appears in calendar
5. Check booking status (pending or auto-validated based on threshold)
