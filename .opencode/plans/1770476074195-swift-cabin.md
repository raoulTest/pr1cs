# Plan: Formulaire de reservation manuelle pour les Carriers

## Resume
Ajouter un formulaire de reservation pour les carriers comme alternative au chatbot. Le backend existe deja - seul le frontend est a creer.

## APIs Backend existantes (aucune modification requise)
- `api.bookings.mutations.create` - cree une reservation (gere toute la validation)
- `api.terminals.queries.list` - liste les terminaux actifs
- `api.trucks.queries.listMyTrucks` - liste les camions du carrier
- `api.containers.queries.listAvailable` - liste les conteneurs disponibles (non reserves)
- `api.timeSlots.queries.getAvailableSlots` - slots disponibles par terminal/date

## Implementation

### 1. Creer le composant BookingForm
**Fichier**: `apps/web/src/features/carrier/components/booking-form.tsx`

Champs du formulaire (ordre sequentiel):
1. **Terminal** - Select depuis `api.terminals.list`
2. **Date** - DatePicker (calendrier)
3. **Creneau horaire** - Grid de slots depuis `api.timeSlots.getAvailableSlots` (depends du terminal + date)
4. **Camion** - Select depuis `api.trucks.listMyTrucks`
5. **Conteneurs** - Multi-select depuis `api.containers.listAvailable`
6. **Info chauffeur** (optionnel) - nom, telephone, numero ID

Stack technique (coherent avec le codebase):
- TanStack Form + Zod pour la validation
- useQuery/useMutation de Convex React
- Composants shadcn/ui (Select, Button, Calendar, etc.)

### 2. Creer la page de nouvelle reservation
**Fichier**: `apps/web/src/routes/_app/carrier/bookings.new.tsx`

- Route: `/carrier/bookings/new`
- Contient le BookingForm
- Redirige vers `/carrier/bookings` avec toast de succes

### 3. Modifier la page Carrier Bookings
**Fichier**: `apps/web/src/routes/_app/carrier/bookings.tsx`

- Ajouter un bouton "Nouvelle reservation" dans le header
- Link vers `/carrier/bookings/new`

### 4. Exporter le composant
**Fichier**: `apps/web/src/features/carrier/index.ts`

- Ajouter l'export de BookingForm

## Fichiers a modifier/creer

| Action | Fichier |
|--------|---------|
| Creer | `apps/web/src/features/carrier/components/booking-form.tsx` |
| Creer | `apps/web/src/routes/_app/carrier/bookings.new.tsx` |
| Modifier | `apps/web/src/routes/_app/carrier/bookings.tsx` |
| Modifier | `apps/web/src/features/carrier/index.ts` |

## Flow utilisateur

```
1. Carrier clique "Nouvelle reservation" sur /carrier/bookings
2. Redirige vers /carrier/bookings/new
3. Selectionne un terminal
4. Selectionne une date → charge les slots disponibles
5. Selectionne un creneau horaire
6. Selectionne un camion
7. Selectionne un ou plusieurs conteneurs
8. (Optionnel) Remplit les infos chauffeur
9. Clique "Reserver"
10. api.bookings.create est appele
11. Succes → toast + redirection vers le calendrier
12. Erreur → affiche le message d'erreur du backend
```

## Validation (geree par le backend)
- Le slot doit etre dans le futur (min/max advance booking)
- Le camion doit etre actif et appartenir au carrier
- Le camion doit etre compatible avec les portes du terminal
- Les conteneurs doivent etre actifs, appartenir au carrier, non reserves
- La capacite doit etre disponible dans le slot

## Verification
1. Se connecter en tant que carrier
2. Aller sur `/carrier/bookings`
3. Cliquer sur "Nouvelle reservation"
4. Remplir le formulaire avec des donnees valides
5. Soumettre et verifier que la reservation apparait dans le calendrier
6. Verifier le statut (pending ou confirmed selon le seuil d'auto-validation)
